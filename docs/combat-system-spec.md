# 3D Space Shooter - 戦闘システム仕様書

最終更新: 2025-07-21

## 現在の実装状況

### 実装済み機能

#### 1. 武器システム
- **プライマリ武器（5種類）**
  - Pulse Laser: 標準エネルギー武器（ダメージ20、連射100ms）
  - Rapid Fire: 高速バースト武器（ダメージ10、連射50ms、3連バースト）
  - Plasma Cannon: 高ダメージAOE武器（ダメージ50、連射300ms、爆発範囲10）
  - Scatter Shot: ショットガン型（ダメージ15、5発同時、拡散30度）
  - Laser Array: 連続ビーム武器（8本回転ビーム、エネルギー消費）

- **セカンダリ/特殊武器（5種類）**
  - Homing Missile: 自動追尾ミサイル（ダメージ40、弾数20）
  - EMP Blast: 範囲スタン武器（3秒スタン、範囲50）
  - Ion Beam: チャージ貫通ビーム（ダメージ100、チャージ2秒）
  - Quantum Torpedo: 障害物貫通魚雷（ダメージ200、弾数5）
  - Shield Projector: 防御シールド（強度100、持続5秒）

#### 2. ターゲティングシステム
- **ロックオン機能**
  - Qキー: ターゲット切り替え
  - Rキー/右クリック: ロックオン切り替え
  - 0.5秒のロックオン時間
  - 視覚的なレティクル表示
  - ターゲット情報表示（距離、HP）

- **マルチロック機能**
  - 最大3ターゲット同時ロック
  - ホーミングミサイルとの連携
  - 100msの連続発射間隔

- **オートエイムアシスト**
  - ロック時0.3強度の自動照準
  - スムーズな補間動作

#### 3. 入力コントロール
- **マウス操作**
  - 左クリック: プライマリ武器発射
  - 中クリック: セカンダリ武器発射
  - 右クリック: ロックオン切り替え
  - マウス移動: 照準操作

- **キーボード操作**
  - 1-9: 武器切り替え
  - Q: ターゲット切り替え
  - R: ロックオン切り替え
  - 1-4: スキル発動

### 技術的な修正履歴
1. ProjectileManagerのdestroy()メソッド追加
2. THREE.MeshBasicMaterialのemissiveプロパティ削除
3. ProjectileManagerのaddProjectileでシーンへのメッシュ追加

## 提案する新機能と改善点

### 1. 高度な照準システム
- **予測照準（リードインジケーター）**
  - 敵の移動を予測して着弾点を表示
  - 武器の弾速に応じた計算
  - 視覚的な予測マーカー

- **ズーム機能**
  - Shiftキーで2段階ズーム
  - スナイパーモード（長距離精密射撃）
  - ズーム中は移動速度低下

### 2. 武器システムの拡張
- **コンボシステム**
  - 異なる武器の連続ヒットでダメージボーナス
  - コンボカウンター表示
  - 特殊コンボエフェクト

- **武器カスタマイズ**
  - モジュラー武器システム
  - 属性付与（炎、氷、電気）
  - 弾薬タイプ変更（貫通、跳弾、分裂）

### 3. 戦術的要素
- **弱点システム**
  - 敵の部位別ダメージ
  - クリティカルヒットゾーン
  - 属性相性システム

- **回避・防御メカニクス**
  - バレルロール（スペースキー2回）
  - エネルギーシールド展開
  - カウンター攻撃

### 4. 特殊戦闘モード
- **ドッグファイトモード**
  - 1対1の高速戦闘
  - 専用カメラアングル
  - QTEによる回避・攻撃

- **砲台モード**
  - 一時的に静止して火力増大
  - 360度旋回砲台
  - オーバーヒートシステム

### 5. UI/UX改善
- **戦闘HUD強化**
  - ダメージ数値表示
  - 命中率統計
  - 弾薬・エネルギー管理UI
  - ミニマップ上の脅威表示

- **フィードバック強化**
  - ヒットマーカーアニメーション
  - 画面振動エフェクト
  - サウンドキューの改善

## 実装優先順位

### フェーズ1（即実装可能）
1. 予測照準システム
2. ダメージ数値表示
3. ヒットマーカー改善
4. 基本的なズーム機能

### フェーズ2（中期目標）
1. 弱点システム
2. コンボシステム
3. 回避メカニクス
4. 武器カスタマイズ基礎

### フェーズ3（長期目標）
1. 特殊戦闘モード
2. 高度な武器カスタマイズ
3. 属性システム
4. AI強化

## 技術的な考慮事項

### パフォーマンス最適化
- 弾丸のオブジェクトプール化
- 視覚エフェクトのLOD
- 物理演算の簡略化

### ネットワーク対応準備
- 弾丸の同期方法
- ヒット判定の権威サーバー化
- 遅延補償システム

### 保存データ構造
- 武器カスタマイズ設定
- 戦闘統計
- アンロック進捗

## 進捗管理

### 完了したタスク
- [x] 基本的な射撃システム
- [x] ProjectileManager実装
- [x] ターゲティングシステム
- [x] 複数の武器タイプ
- [x] エラー修正（destroy()メソッド、emissiveプロパティ）

### 進行中のタスク
- [ ] 戦闘システム仕様の策定
- [ ] 予測照準の設計

### 今後のタスク
- [ ] 予測照準システムの実装
- [ ] ダメージ表示システム
- [ ] ズーム機能
- [ ] 弱点システム
- [ ] コンボシステム

## 関連ファイル
- `/src/systems/WeaponSystem.js` - メイン武器システム
- `/src/systems/TargetingSystem.js` - ターゲティングシステム
- `/src/systems/ProjectileManager.js` - 弾丸管理
- `/src/weapons/WeaponTypes.js` - 武器定義
- `/src/entities/Projectile.js` - 弾丸エンティティ

## 変更履歴
- 2025-07-21: 初版作成、現状分析と新機能提案